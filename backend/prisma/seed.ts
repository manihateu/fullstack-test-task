import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('ðŸŒ± Ð—Ð°Ð¿ÑƒÑÐº seed...');

  const ideas = [
    { title: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ‘Ð¼Ð½ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð³Ð»Ð°Ð·Ð° Ð½Ðµ ÑƒÑÑ‚Ð°Ð²Ð°Ð»Ð¸ Ð½Ð¾Ñ‡ÑŒÑŽ' },
    { title: 'Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ', description: 'Ð”Ð»Ñ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ñ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°' },
    { title: 'Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Telegram', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Ñ‡Ð°Ñ‚' },
    { title: 'API Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²', description: 'ÐŸÐ¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½Ð¸Ð¼ ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒÑÑ' },
    { title: 'Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²', description: 'ÐŸÑƒÑÑ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°ÑŽÑ‚ Ð¸Ð´ÐµÐ¸' },
    { title: 'Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÑÑ‚ÑŒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð²Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð´ÐµÑŽ' },
    { title: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ³Ð¸ Ð´Ð»Ñ Ð¸Ð´ÐµÐ¹', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ñ‰Ðµ Ð±Ñ‹Ð»Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸ Ð¸ÑÐºÐ°Ñ‚ÑŒ' },
    { title: 'Ð›Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ Ð¸Ð´ÐµÐ¸ Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ°' },
    { title: 'Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ñ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð»ÑŽÐ´ÐµÐ¹ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°Ñ‚ÑŒ Ð¸Ð´ÐµÐ¸' },
    { title: 'ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… ÑÐ·Ñ‹ÐºÐ¾Ð²', description: 'Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑÐ°Ð¹Ñ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼ Ð´Ð»Ñ Ð²ÑÐµÑ…' },
    { title: 'Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾ Ð½Ð¾Ð²Ñ‹Ñ… Ð¸Ð´ÐµÑÑ…', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ ÑÐ²ÐµÐ¶Ð¸Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ' },
    { title: 'ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¸Ð´ÐµÐ¹', description: 'Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ´ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸ÐµÐ¹' },
    { title: 'Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ Ð¸Ð´ÐµÐ¸', description: 'Ð˜ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸' },
    { title: 'Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ', description: 'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð²Ð¸Ð´ÐµÑ‚ÑŒ ÑÐ°Ð¼Ñ‹Ðµ Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ' },
    { title: 'Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð¸Ð´ÐµÐ¹', description: 'ÐŸÑ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹' },
    ];

  for (const data of ideas) {
    await prisma.idea.create({
      data
    });
  }

  console.log('ðŸ’¡ Ð˜Ð´ÐµÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹');

  const votes = [
    { ip: '1.1.1.1', ideaId: 1 },
    { ip: '1.1.1.1', ideaId: 2 },
    { ip: '2.2.2.2', ideaId: 1 },
    { ip: '3.3.3.3', ideaId: 3 },
  ];

  await prisma.vote.createMany({
    data: votes,
  });

  const allIdeas = await prisma.idea.findMany({ select: { id: true } });
  for (const idea of allIdeas) {
    const votesCount = await prisma.vote.count({ where: { ideaId: idea.id } });
    await prisma.idea.update({
      where: { id: idea.id },
      data: { votesCount },
    });
  }

  console.log('âœ… Ð“Ð¾Ð»Ð¾ÑÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¸ Ð¿Ð¾Ð´ÑÑ‡Ð¸Ñ‚Ð°Ð½Ñ‹');
  console.log('ðŸŒ± Seed Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!');
}

main()
  .catch((e) => {
    console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸ seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
